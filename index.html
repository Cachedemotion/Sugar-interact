
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cachedemotion çš„è‡ªåŠ¨æ’’ç³–æœºâ„¢</title>
  <script src="cn_sugar_library.js"></script>
  <script src="en_sugar_library.js"></script>
  <style>
    body {
      background-color: #FFF0F5;
      font-family: 'Arial Rounded MT Bold', 'Segoe UI', sans-serif;
      text-align: center;
      color: #D63384;
      padding: 2em;
    }
    h1 {
      font-size: 2.2em;
      margin-bottom: 0.2em;
    }
    button {
      padding: 0.7em 1.5em;
      border: none;
      border-radius: 10px;
      background: #F472B6;
      color: white;
      font-size: 1em;
      margin: 0.5em;
      cursor: pointer;
    }
    .big-button {
      font-size: 1.2em;
      padding: 0.8em 2em;
      margin: 1em auto;
      display: block;
    }
    input {
      padding: 0.5em;
      margin: 0.3em;
      border-radius: 6px;
      border: 1px solid #F9A8D4;
      width: 80%;
      max-width: 300px;
    }
    #sugarDisplay {
      font-size: 1.2em;
      margin: 1em auto;
      max-width: 600px;
      white-space: pre-line;
    }
    #note {
      font-size: 0.9em;
      color: #9D174D;
      margin-top: 0.5em;
    }
  </style>
</head>
<body>
  <h1>ğŸ’— Cachedemotion çš„ Sugar Machineâ„¢</h1>

  <div>
    <button onclick="setLanguage('cn')" id="langCnBtn">ä¸­æ–‡ ğŸ‡¨ğŸ‡³</button>
    <button onclick="setLanguage('en')" id="langEnBtn">English ğŸ‡ºğŸ‡¸</button>
  </div>

  <button class="big-button" onclick="generateSweet()" id="generateBtn">éšæœºæ’’ç³– ğŸ¬</button>
  <button onclick="copySweet()" id="copyBtn">ğŸ“‹ å¤åˆ¶</button>

  <div id="sugarDisplay">ç‚¹ä¸€ä¸‹ä¸Šé¢çš„æŒ‰é’®æ¥æ”¶ç³–å§ï½</div>

  <hr style="margin: 2em 0;">

  <h3 id="addTitle">â• æ·»åŠ ä½ è‡ªå·±çš„ç³–è¯</h3>
  <div>
    <input id="prefix" placeholder="å¼€åœºç™½ï¼ˆä¾‹ï¼šä½ çŸ¥é“å—ï¼Ÿï¼‰"><br>
    <input id="subject" placeholder="ä¸»ä½“ï¼ˆä¾‹ï¼šä½ è¿™ä¸ªï¼‰"><br>
    <input id="metaphor" placeholder="æ¯”å–»ï¼ˆä¾‹ï¼šè½¯èŒç¨‹åºç²¾çµï¼‰"><br>
    <input id="ending" placeholder="ç»“å°¾ï¼ˆä¾‹ï¼šä»Šå¤©ä¹Ÿå¤ªå¥½çœ‹äº†å§ï¼ï¼‰"><br>
    <button onclick="addToLocal()" id="addBtn">ğŸ¯ åŠ å…¥æˆ‘çš„ç³–ç½</button>
    <button onclick="submitToForm()" id="submitBtn">ğŸ“® æäº¤ç»™ Cachedemotion</button>
    <div id="note">
      ğŸŒŸ ä½ çš„ç³–è¯å¯èƒ½ä¼šè¢« Cachedemotion æ”¶è—è¿›å®˜æ–¹ç³–ç½ï¼Œç”œåˆ°å…¨å®‡å®™ï¼<br>
      ğŸŒŸ Your sweet talk may be picked by Cachedemotion and saved into the sugar jar forever!
    </div>
  </div>

  <script>
    let currentLang = "cn";

    const display = document.getElementById("sugarDisplay");
    const prefixInput = document.getElementById("prefix");
    const subjectInput = document.getElementById("subject");
    const metaphorInput = document.getElementById("metaphor");
    const endingInput = document.getElementById("ending");

    const placeholders = {
      cn: ["å¼€åœºç™½ï¼ˆä¾‹ï¼šä½ çŸ¥é“å—ï¼Ÿï¼‰", "ä¸»ä½“ï¼ˆä¾‹ï¼šä½ è¿™ä¸ªï¼‰", "æ¯”å–»ï¼ˆä¾‹ï¼šè½¯èŒç¨‹åºç²¾çµï¼‰", "ç»“å°¾ï¼ˆä¾‹ï¼šä»Šå¤©ä¹Ÿå¤ªå¥½çœ‹äº†å§ï¼ï¼‰"],
      en: ["Prefix (e.g. You know what?)", "Subject (e.g. You're basically)", "Metaphor (e.g. sunlight turned into a dessert)", "Ending (e.g. I'm rebooting for you)"]
    };

    function setLanguage(lang) {
      currentLang = lang;

      const lib = lang === "cn" ? sugarLibraryCN : sugarLibraryEN;
      localStorage.setItem("prefixes_" + lang, JSON.stringify(lib.prefixes));
      localStorage.setItem("subjects_" + lang, JSON.stringify(lib.subjects));
      localStorage.setItem("metaphors_" + lang, JSON.stringify(lib.metaphors));
      localStorage.setItem("endings_" + lang, JSON.stringify(lib.endings));

      // æ›´æ–°æ–‡å­—
      document.getElementById("generateBtn").innerText = lang === "cn" ? "éšæœºæ’’ç³– ğŸ¬" : "Sweet Talk ğŸ¬";
      document.getElementById("copyBtn").innerText = lang === "cn" ? "ğŸ“‹ å¤åˆ¶" : "ğŸ“‹ Copy";
      document.getElementById("addTitle").innerText = lang === "cn" ? "â• æ·»åŠ ä½ è‡ªå·±çš„ç³–è¯è¿›å…¥å¾ªç¯" : "â• Add your own sweet talk";
      document.getElementById("addBtn").innerText = lang === "cn" ? "ğŸ¯ åŠ å…¥æˆ‘çš„ç³–ç½" : "ğŸ¯ Save to my jar";
      document.getElementById("submitBtn").innerText = lang === "cn" ? "ğŸ“® æäº¤ç»™ Cachedemotion" : "ğŸ“® Submit to Cachedemotion";
      document.getElementById("note").innerHTML = lang === "cn"
        ? "ğŸŒŸ æäº¤åä½ çš„ç³–è¯å¯èƒ½ä¼šè¢« Cachedemotion æ”¶è—è¿›å®˜æ–¹ç³–ç½ï¼Œç”œåˆ°å…¨å®‡å®™ï¼<br>"
        : "ğŸŒŸ If submitted, your sweet talk may be picked by Cachedemotion and saved into the sugar jar forever!<br>";

      [prefixInput, subjectInput, metaphorInput, endingInput].forEach((el, i) => {
        el.placeholder = placeholders[lang][i];
      });

      display.innerText = lang === "cn" ? "ç‚¹ä¸€ä¸‹ä¸Šé¢çš„æŒ‰é’®æ¥æ”¶ç³–å§ï½" : "Click above to generate sweet talk~";
    }

    function getLocal(key) {
      return JSON.parse(localStorage.getItem(key + "_" + currentLang) || "[]");
    }

    function saveLocal(key, arr) {
      localStorage.setItem(key + "_" + currentLang, JSON.stringify(arr));
    }

    function generateSweet() {
      const p = getLocal("prefixes");
      const s = getLocal("subjects");
      const m = getLocal("metaphors");
      const e = getLocal("endings");

      if (!p.length || !s.length || !m.length || !e.length) {
        display.innerText = currentLang === "cn" ? "ä½ çš„ç³–ç½è¿˜ç©ºç©ºçš„ï½å¿«æ·»åŠ å‡ å¥å§ï¼" : "Your sugar jar is empty~ Add something!";
        return;
      }

      const rand = arr => arr[Math.floor(Math.random() * arr.length)];
      const sweet = `${rand(p)}
${rand(s)} ${rand(m)}.
${rand(e)}`;
      display.innerText = sweet;
    }

    function copySweet() {
      navigator.clipboard.writeText(display.innerText).then(() => {
        alert(currentLang === "cn" ? "âœ… ç³–è¯å·²å¤åˆ¶ï¼" : "âœ… Copied!");
      });
    }

    function addToLocal() {
      const prefix = prefixInput.value;
      const subject = subjectInput.value;
      const metaphor = metaphorInput.value;
      const ending = endingInput.value;

      if (prefix || subject || metaphor || ending) {
        if (prefix) saveLocal("prefixes", [...getLocal("prefixes"), prefix]);
        if (subject) saveLocal("subjects", [...getLocal("subjects"), subject]);
        if (metaphor) saveLocal("metaphors", [...getLocal("metaphors"), metaphor]);
        if (ending) saveLocal("endings", [...getLocal("endings"), ending]);
        alert(currentLang === "cn" ? "ğŸ¬ ä½ çš„ç³–è¯å·²åŠ å…¥ç³–ç½ï¼" : "ğŸ¬ Sweet added to your jar!");
      } else {
        alert(currentLang === "cn" ? "è¯·è‡³å°‘å¡«å†™ä¸€é¡¹å†…å®¹ï¼" : "Please enter at least one field!");
      }
    }

    function submitToForm() {
      const prefix = prefixInput.value || "";
      const subject = subjectInput.value || "";
      const metaphor = metaphorInput.value || "";
      const ending = endingInput.value || "";

      if (!(prefix || subject || metaphor || ending)) {
        alert(currentLang === "cn" ? "è¯·è‡³å°‘å¡«å†™ä¸€é¡¹å†…å®¹ï¼" : "Please enter at least one field!");
        return;
      }

      const form = document.createElement("form");
      form.action = "https://docs.google.com/forms/d/e/1FAIpQLScEOUSAYSE9T_uF68tRi2ba8ihrqAmB9XLi8dlEzs47kRovwA/formResponse";
      form.method = "POST";
      form.target = "hidden_iframe";

      const fields = {
        "entry.484390581": prefix,
        "entry.1229648892": subject,
        "entry.1310047270": metaphor,
        "entry.18238429": ending
      };

      for (const key in fields) {
        const input = document.createElement("input");
        input.type = "hidden";
        input.name = key;
        input.value = fields[key];
        form.appendChild(input);
      }

      console.log("Submitting:", fields);
      document.body.appendChild(form);
      form.submit();
      alert(currentLang === "cn" ? "ğŸ“® å·²æäº¤åˆ° Cachedemotion çš„ç³–ç½ï¼" : "ğŸ“® Submitted to Cachedemotion's jar!");
      form.remove();
    }

    window.onload = () => {
      setLanguage("cn");
    }
  </script>

  <iframe name="hidden_iframe" style="display:none;"></iframe>
</body>
</html>
